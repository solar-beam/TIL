# 001 Http Message

> 츠토모 토네, 성공과 실패를 결정하는 1%의 네트워크 원리

브라우저 주소창에 `http://www.naver.com`을 입력하고 웹페이지가 표시되는 과정을 설명하겠습니다. 거칠게 말하면 브라우저는 웹서버에 데이터를 요청하고 웹서버에서 받은 데이터를 화면에 표시하는 것이 전부입니다. 브라우저와 웹서버의 대화는 브라우저가 요청 메시지를 작성하는 것에서 시작됩니다.

  

사용자는 URL로 원하는 정보가 위치한 경로를 입력합니다.

- URL (Uniform Resource Location) / URI (Uniform Resource Identifier)

  ① `http:`는 HTTP 프로토콜을 사용하여 접속한다는 뜻으로, FTP 서버라면 `fpt:`, 클라이언트 컴퓨터 파일에서 데이터를 읽는 경우 `file:`, 메일을 송신하는 경우 `mailto:`라고 적습니다.

  ② `//`는 이어지는 문자열이 서버 이름이라는 뜻입니다. 접근할 웹페이지의 도메인 주소(`www.naver.com`)를 적습니다(필요시 포트번호를 기재합니다.)

  ③ 이후로는 `/[디렉토리명]/[서브 디렉토리명]/.../[파일명]` 구조로 접근할 데이터의 위치를 표시합니다(필요시 사용자 입력값을 기재합니다.) 파일명이나 디렉토리 이하 `/` 문자를 생략하는 경우도 있습니다.

  

이를 바탕으로 브라우저가 HTTP 요청 메시지를 작성합니다. 메시지 형식은 다음과 같은 규칙을 따릅니다.

- 요청 메시지 : 요청 메시지에 쓰는 URI는 파일을 한번에 하나씩만 읽을 수 있기 때문에 파일을 따로따로 요청해야 한다. 한 문장에 3개의 영상이 포함되어 있다면, 문장과 영상을 모두 4회의 요청 메시지를 보낸다.

  ```
  <메소드><공백><URI><공백><HTTP 버전>
  <필드명>:<필드값>
  ...
  <공백 행>
  <메시지 본문>
  ```

- 응답 메시지

  ```
  <HTTP 버전><공백><스테이터스 코드><공백><응답 문구>
  <필드명>:<필드값>
  ...
  <공백 행>
  <메시지 본문>
  ```

- [Request Method](https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods)
  
    - GET : URI로 지정한 정보를 도출한다. 파일의 경우 해당 파일의 내용을, CGI 프로그램의 경우 출력 데이터를 반송한다(사용자 입력값을 URI에 포함해서 전달한다.)
    - POST : 클라이언트에서 서버로 데이터를 송신한다. 폼에 입력한 데이터를 송신하는 경우이다(사용자 입력값은 메시지 헤더에 포함해서 전달한다.)
    
- [Response Status Code](https://developer.mozilla.org/en-US/docs/Web/HTTP/Status)
  
  - `1XX` : 처리의 경과 상황 등을 통지
  - `2XX` : 정상 종료
  - `3XX` : 무언가 다른 조치가 필요함
  - `4XX` : 클라이언트측 오류
  - `5XX` : 서버측 오류
  
- [Header Field](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers)

  - General Header : 요청/응답 양쪽에 모두 사용됨. 요청/응답 작성된 날짜, 데이터 캐시 허용여부, 캐시 제어정보, TCP 접속유지여부, 메시지 본문 인코딩 방식, 경유한 프록시/게이트웨이 등
  - Request Header : 요청의 부가정보. 사용자 인증용 데이터, 발신자의 메일주소, 클라이언트 정보, 클라이언트 측이 받는 데이터의 종류, 서버의 IP주소와 포트번호 등.
  - Response Header : 응답의 부가정보로서. URI가 상대경로인 경우 절대경로, 서버정보, 사용자 인증용 데이터 등.
  - Entity Header : 메시지 본문의 부가 정보. 지정한 URI로 사용가능한 메소드와 인코딩방식, 메시지 본문의 길이, 데이터 종류(MIME), 유효기간, 최종변경일시 등.

  

도메인주소를 입력하면 DNS 리졸버를 이용해 IP로 리졸브(변환)한다. DNS서버는 도메인 계층에 따라 트리 구조로 계층화되어 있는데, 리졸버가 이를 거슬러 올라가며 사용자가 입력한 도메인주소가 저장된 서버를 찾는다. 이때 캐시 서버 또는 한 대의 서버에서 여러 도메인을 다룸으로써 비용을 절약할 수 있다. DNS서버에는 다음과 같이 도메인주소와 IP주소가 매핑되어 있다.

| 이름                | 클래스 | 타입 | 클라이언트에 응답하는 항목 |
| ------------------- | ------ | ---- | -------------------------- |
| www.lab.cyber.co.kr | IN     | A    | 192.0.2.226                |
| cyber.co.kr         | IN     | MX   | 10 mail.cyber.co.kr        |
| mail.cyber.co.kr    | IN     | A    | 192.0.2.227                |

- 이름 : 도메인 이름의 `www`는 관행일 뿐이어서, `myWebServer`나 `MySrv` 등 마음에 드는 이름을 붙일 수 있다.
- 타입 : 이름에 매핑된 정보의 종류를 가리킨다. IP주소면 `A`, 메일서버면 `MX(Mail Exchange)`를 사용한다.

- 응답 : IP주소, 메일서버의 이름 등이 기재되어 있다. 메일서버 이름 앞에는 우선순위를 비교하기 위한 인덱스를 붙인다. 작은 값일 수록 우선하여 접속한다.

  

이상으로 웹브라우저는 HTTP 프로토콜에 따라 서버에 보낼 요청 메시지를 작성했습니다.